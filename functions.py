import numpy as np

# ===============================
# ЛИНЕЙНЫЕ ВНЕШНИЕ ФАКТОРЫ Fi(t)
# ===============================

def F1(t, params):  # обучение / подготовка пилотов
    a, b = params
    return np.clip(a + b * t, 0.1, 1.0)

def F2(t, params):  # рост частной авиации
    a, b = params
    return np.clip(a + b * t, 0.1, 1.0)

def F3(t, params):  # усиление контроля
    a, b = params
    return np.clip(a + b * t, 0.1, 1.0)

def F4(t, params):  # развитие метеослужб
    a, b = params
    return np.clip(a + b * t, 0.1, 1.0)

def F5(t, params):  # общий уровень безопасности
    a, b = params
    return np.clip(a + b * t, 0.1, 1.0)


# ===============================
# ЛИНЕЙНАЯ ФУНКЦИЯ ВЛИЯНИЯ
# ===============================

def fx(x, params):
    k, b = params
    return np.clip(k * x + b, 0.05, 0.95)


# ===============================
# ЛИНЕЙНАЯ СИСТЕМА УРАВНЕНИЙ
# ===============================

def pend(u, t, factors, f):
    """
    u = [X1..X8]
    factors = [(a,b)*5]
    f = [(k,b)*18]
    """

    X1, X2, X3, X4, X5, X6, X7, X8 = u

    F1_val = F1(t, factors[0])
    F2_val = F2(t, factors[1])
    F3_val = F3(t, factors[2])
    F4_val = F4(t, factors[3])
    F5_val = F5(t, factors[4])

    dudt = np.zeros(8)

    # ===============================
    # УПРАВЛЯЮЩИЕ ПОКАЗАТЕЛИ
    # ===============================

    # X1 — нарушения пилотами (должны уменьшаться)
    dudt[0] = -0.6 * F1_val - 0.4 * fx(X3, f[0])

    # X2 — доля частных судов (растёт)
    dudt[1] =  0.5 * F2_val - 0.2 * X2

    # X3 — активность контроля (растёт)
    dudt[2] =  0.6 * F3_val - 0.3 * X3

    # X4 — метеослужбы (растут)
    dudt[3] =  0.6 * F4_val - 0.3 * X4


    # ===============================
    # ПРИЧИНЫ КАТАСТРОФ
    # ===============================

    # X5 — метеоусловия (уменьшаются при росте X4)
    dudt[4] =  0.5 * X1 - 0.7 * X4 - 0.2 * X5

    # X6 — технические неисправности (уменьшаются при росте контроля)
    dudt[5] =  0.4 * X2 - 0.7 * X3 - 0.2 * X6

    # X7 — человеческий фактор (уменьшается при снижении X1)
    dudt[6] =  0.6 * X1 - 0.6 * X3 - 0.2 * X7


    # ===============================
    # ОБЩЕЕ ЧИСЛО КАТАСТРОФ
    # ===============================

    dudt[7] = -0.6 * X8

    return np.clip(dudt, -0.5, 0.5)
