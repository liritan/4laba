<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Модель АТС - Анализ авиационных катастроф</title>
    <link href="/static/css/style.css" rel="stylesheet" />
    <style>
        .top-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .half-width-col {
            width: calc(50% - 5px);
            display: flex;
            flex-direction: column; 
            height: 800px;
        }

        .block-function {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 4px;
            white-space: nowrap;
        }

        .faks-input, .equation-input {
            width: 50px;
            padding: 2px;
            margin: 0;
            text-align: center;
        }

        .equations-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: auto; 
            padding: 5px;
            border: 1px solid #ccc;
            background-color: #fff;
        }

        .characteristics-container {
            flex: 1;
            overflow-y: auto;
            padding: 5px;
            border: 1px solid #ccc;
            background-color: #fff;
        }

        /* Стили для компактного блока начальных условий (изменены для точного соответствия первому файлу) */
        .compact-initial-container {
            margin-top: 20px;
            width: 100%;
        }
        .compact-initial-header {
            display: flex;
            justify-content: space-between;
            background-color: #f0f0f0;
            font-weight: bold;
            padding: 8px 0;
            margin-bottom: 8px;
            font-size: 14px; /* как в первом файле */
        }
        .compact-initial-header .label-col {
            flex: 2;
            padding-left: 10px;
        }
        .compact-initial-header .value-col,
        .compact-initial-header .limit-col {
            flex: 1;
            text-align: center;
        }
        .compact-initial-row {
            display: flex;
            align-items: center;
            padding: 6px 0; /* чуть плотнее, как в первом файле */
            border-bottom: 1px solid #eee;
            font-size: 14px; /* основной размер шрифта соответствует первому файлу */
            line-height: 1.3;
        }
        /* здесь важно, чтобы левая колонка содержала две строки: X# и подпись (описание) */
        .compact-initial-row .label-col {
            flex: 2;
            display: flex;
            align-items: center;
            padding-left: 10px;
            gap: 10px;
        }
        /* "X#" - основная метка */
        .compact-initial-row .label-col .x-label {
            font-size: 16px;
        }
        /* описание характеристики (подпись) — меньше и более приглушённый цвет */
        .compact-initial-row .label-col .param-label {
                            flex: 1;
                font-size: 14px;
                color: #2c3e50;                    font-weight: 600;
                line-height: 1.3;
        }

        .compact-initial-row .value-col,
        .compact-initial-row .limit-col {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .compact-initial-row input {
            width: 60px;
            padding: 4px;
            text-align: center;
            font-size: 14px;
        }

        /* Стили для легковесного блока управления */
        .control-panel-light {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .status-line {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-line span {
            font-weight: 500;
            min-width: 60px;
        }

        .status-line input {
            width: 120px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            font-size: 13px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .btn-calculate,
        .btn-refresh,
        .btn-clear {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-calculate {
            background-color: #007bff;
            color: white;
        }

        .btn-calculate:hover {
            background-color: #0056b3;
        }

        .btn-refresh {
            background-color: #6c757d;
            color: white;
        }

        .btn-refresh:hover {
            background-color: #545b62;
        }

        .btn-clear {
            background-color: #dc3545;
            color: white;
        }

        .btn-clear:hover {
            background-color: #c82333;
        }
        
        .formula-text {
            margin: 0 2px;
            font-size: 14px;
            font-family: Arial, sans-serif;
            line-height: 1.5;
        }
        
        .function-label {
            min-width: 60px;
            font-family: Arial, sans-serif;
            line-height: 1.5;
            font-size: 18px;
        }
        
        .faks-description {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }
        
        .eq-expression {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
<div>
<header>
    <ul class="nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" href="/">Параметры</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/graphic">График</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/diagrams">Диаграммы</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/facks">Возмущения</a>
        </li>
    </ul>
</header>
<div class="all">
<div class="container">
    <h2 class="page-title">Модель АТС - Анализ авиационных катастроф</h2>
    <p class="page-subtitle">Моделирование системы авиационной транспортной безопасности</p>
    
    <form id="fullForm" method="post">
        <div class="top-row">
            <!-- Блок возмущений -->
            <div class="half-width-col">
                <h5>Возмущения</h5>
                <div class="characteristics-container">
                    {% for i in range(1,6) %}
                    <div class="block-function">
                        <div class="function-label">F{{ i | subscript }}(t) =</div>
                        <div class="eq-expression">
                            <input class="faks-input" name="fak{{ i }}_a" 
                                   value="{{ (values.faks[i-1][0] if values else defaults.faks[i-1][0]) }}"
                                   placeholder="0.5" type="text" />
                            <span class="formula-text">+</span>
                            <input class="faks-input" name="fak{{ i }}_b" 
                                   value="{{ (values.faks[i-1][1] if values else defaults.faks[i-1][1]) }}"
                                   placeholder="0.0" type="text" />
                            <span class="formula-text">·t</span>
                        </div>
                        <span class="faks-description">
                            {% if i == 1 %}Средняя выработка ресурса до списания{% endif %}
                            {% if i == 2 %}Доля иностранных воздушных судов{% endif %}
                            {% if i == 3 %}Средний лётный стаж пилотов{% endif %}
                            {% if i == 4 %}Стоимость авиационного топлива{% endif %}
                            {% if i == 5 %}Количество нормативно-правовых актов{% endif %}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Блок уравнений характеристик -->
            <div class="half-width-col">
                <h5>Внутренние функции модели</h5>
                <div class="equations-container">
                    {% for i in range(1,19) %}
                        {% set u_var = get_u_variable_for_equation(i) %}
                        {% set u_subscript = u_var | subscript %}
                        <div class="block-function">
                            <div class="function-label">f{{ i | subscript }}(X{{ u_subscript }}) =</div>
                            <div class="eq-expression">
                                <input class="equation-input" name="f{{ i }}_k" 
                                       value="{{ (values.equations[i-1][0] if values else defaults.equations[i-1][0]) }}"
                                       placeholder="0.5" type="text" />
                                <span class="formula-text">·X{{ u_subscript }} +</span>
                                <input class="equation-input" name="f{{ i }}_b" 
                                       value="{{ (values.equations[i-1][1] if values else defaults.equations[i-1][1]) }}"
                                       placeholder="0.5" type="text" />
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Начальные условия и ограничения -->
        <div class="compact-initial-container">
            <h5>Начальные условия</h5>
            <div class="compact-initial-header">
                <div class="label-col">Характеристика</div>
                <div class="value-col">Начальное условие</div>
                <div class="limit-col">Предел</div>
            </div>

            {% for i in range(1,9) %}
            <div class="compact-initial-row">
                <div class="label-col">
                    <!-- Разделил на две строки: X# и описание (param-label) -->
                    <div class="x-label">X{{ i }}</div>
                    <div class="param-label">{{ u_labels[i-1] }}</div>
                </div>
                <div class="value-col">
                    <input name="u{{ i }}" 
                           value="{{ (values.u[i-1] if values else defaults.u[i-1]) }}" 
                           placeholder="0.5" type="text" />
                </div>
                <div class="limit-col">
                    <input name="u_restrictions{{ i }}" 
                           value="{{ (values.u_restrictions[i-1] if values else defaults.u_restrictions[i-1]) }}" 
                           placeholder="1.0" type="text" />
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Панель управления -->
        
        <div class="control-row">
        <div class="control-section">
            <h5>Управление расчетами</h5>
            <div class="control-panel-light">
                <div class="status-line">
                    <span>Статус:</span>
                    <input type="text" readonly id="status-input" value="Готов к расчетам" class="status-ready" />
                    <div class="button-group">
                         <button type="submit" class="btn-calculate" id="calculate-btn">Вычислить</button>
                        <button type="button" class="btn-refresh" id="random-fill-btn">Обновить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </form>
    
    {% if error %}
    <div class="alert alert-danger" style="margin-top: 20px;">
        <strong>Ошибка:</strong> {{ error }}
    </div>
    {% endif %}
    
    {% if success %}
    <div class="alert alert-success" style="margin-top: 20px;">
        <strong>Успешно:</strong> {{ success }}
    </div>
    {% endif %}
</div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('fullForm');
    const statusInput = document.getElementById('status-input');
    const randomFillBtn = document.getElementById('random-fill-btn');
    const clearBtn = document.getElementById('clear-btn');
    
    // Обработка отправки формы
    form.addEventListener('submit', function(e) {
        statusInput.value = "Вычисление...";
        statusInput.className = "status-calculating";
    });
    
    // Заполнение случайными значениями
    randomFillBtn.addEventListener('click', function() {
        // Заполняем начальные условия (0.1-0.8)
        for(let i = 1; i <= 8; i++) {
            const input = document.querySelector(`input[name="u${i}"]`);
            if(input) input.value = (Math.random() * 0.7 + 0.1).toFixed(2);
            
            const restriction = document.querySelector(`input[name="u_restrictions${i}"]`);
            if(restriction) restriction.value = (Math.random() * 0.2 + 0.85).toFixed(2);
        }
        
        // Заполняем возмущения
        for(let i = 1; i <= 5; i++) {
            const aInput = document.querySelector(`input[name="fak${i}_a"]`);
            const bInput = document.querySelector(`input[name="fak${i}_b"]`);
            if(aInput) aInput.value = (Math.random() * 0.5 + 0.3).toFixed(2);
            if(bInput) bInput.value = (Math.random() * 0.4 - 0.2).toFixed(2);
        }
        
        // Заполняем уравнения
        for(let i = 1; i <= 18; i++) {
            const kInput = document.querySelector(`input[name="f${i}_k"]`);
            const bInput = document.querySelector(`input[name="f${i}_b"]`);
            if(kInput) kInput.value = (Math.random() * 1.6 - 0.8).toFixed(2);
            if(bInput) bInput.value = (Math.random() * 0.8 + 0.1).toFixed(2);
        }
        
        statusInput.value = "Заполнено случайно";
        statusInput.className = "status-ready";
    });
    
    // Очистка формы
    if (clearBtn) {
        clearBtn.addEventListener('click', function() {
            const inputs = form.querySelectorAll('input[type="text"]');
            inputs.forEach(input => {
                input.value = '';
            });
            statusInput.value = "Форма очищена";
            statusInput.className = "status-ready";
        });
    }
});
</script>
</body>
</html>